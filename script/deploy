#!/usr/bin/env rc

app=$home/Dropbox/src/bloggart
echo 'deploy: app dir is: '$app >[1=2]

head=`{cat $app/.git/refs/heads/onideas}
echo 'deploy: git heads/onideas version is: '$head >[1=2]

sed -i '' -e 's/^version: .*/version: '$head'/' $app/app.yaml

fn sigexit sigint sigterm {
	git checkout $app/app.yaml
}

{
	cd $app
	git checkout onideas
} || exit 1

/usr/local/google_appengine/appcfg.py -e anh.hai.trinh@gmail.com update $app \
	&& $app/script/post_deploy -v $head \
	|| exit 1
